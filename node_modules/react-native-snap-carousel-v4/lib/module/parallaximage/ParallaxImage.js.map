{"version":3,"sources":["ParallaxImage.tsx"],"names":["React","Component","View","Animated","Easing","ActivityIndicator","findNodeHandle","styles","ParallaxImageStatus","ParallaxImage","constructor","props","state","offset","width","height","status","LOADING","animOpacity","Value","_onLoad","bind","_onError","_measureLayout","setNativeProps","nativeProps","_container","componentDidMount","_mounted","setTimeout","componentWillUnmount","dimensions","carouselRef","nodeHandle","measureLayout","x","y","vertical","sliderHeight","itemHeight","sliderWidth","itemWidth","setState","Math","ceil","event","fadeDuration","onLoad","LOADED","timing","toValue","duration","easing","out","quad","isInteraction","useNativeDriver","start","TRANSITION_FINISHED","onError","ERROR","image","scrollPosition","parallaxFactor","style","AnimatedImageComponent","other","parallaxPadding","requiredStyles","position","dynamicStyles","opacity","transform","translateX","interpolate","inputRange","outputRange","extrapolate","translateY","undefined","spinner","showSpinner","spinnerColor","loaderContainer","render","containerStyle","c","container","Image"],"mappings":"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","sourcesContent":["// Parallax effect inspired by https://github.com/oblador/react-native-parallax/\r\n\r\nimport React, { Component } from 'react';\r\nimport {\r\n    View,\r\n    Animated,\r\n    Easing,\r\n    ActivityIndicator,\r\n    findNodeHandle,\r\n    ImageProps,\r\n    StyleProp,\r\n    ViewStyle,\r\n    NativeSyntheticEvent,\r\n    ImageLoadEventData,\r\n    ImageErrorEventData\r\n} from 'react-native';\r\nimport styles from './ParallaxImage.style';\r\n\r\ntype VerticalProps = {\r\n    vertical: true;\r\n    sliderHeight: number; // passed from <Carousel />\r\n    itemHeight: number; // passed from <Carousel />\r\n}\r\ntype HorizontalProps = {\r\n    vertical: false;\r\n    sliderWidth: number; // passed from <Carousel />\r\n    itemWidth: number; // passed from <Carousel />\r\n}\r\n\r\ntype ParallaxImageProps = {\r\n  carouselRef: Parameters<typeof findNodeHandle>[0]; // passed from <Carousel />\r\n  scrollPosition: Animated.Value | undefined; // passed from <Carousel />\r\n  containerStyle: StyleProp<ViewStyle>;\r\n  dimensions?: {\r\n    width: number;\r\n    height: number;\r\n  };\r\n  fadeDuration: number;\r\n  parallaxFactor: number;\r\n  showSpinner: boolean;\r\n  spinnerColor: string;\r\n  AnimatedImageComponent: typeof Animated.Image;\r\n} & ImageProps & (VerticalProps | HorizontalProps);\r\n\r\nexport enum ParallaxImageStatus {\r\n    'LOADING' = 1,\r\n    'LOADED' = 2,\r\n    'TRANSITION_FINISHED' = 3,\r\n    'ERROR' = 4\r\n}\r\n\r\ntype ParallaxImageState = {\r\n  offset: number;\r\n  width: number;\r\n  height: number;\r\n  status: ParallaxImageStatus;\r\n  animOpacity: Animated.Value;\r\n};\r\n\r\nexport default class ParallaxImage extends Component<\r\n  ParallaxImageProps,\r\n  ParallaxImageState\r\n> {\r\n  static defaultProps = {\r\n      containerStyle: {},\r\n      fadeDuration: 500,\r\n      parallaxFactor: 0.3,\r\n      showSpinner: true,\r\n      spinnerColor: 'rgba(0, 0, 0, 0.4)',\r\n      AnimatedImageComponent: Animated.Image\r\n  };\r\n\r\n  _container?: View | null;\r\n  _mounted?: boolean;\r\n\r\n  constructor (props: ParallaxImageProps) {\r\n      super(props);\r\n      this.state = {\r\n          offset: 0,\r\n          width: 0,\r\n          height: 0,\r\n          status: ParallaxImageStatus.LOADING,\r\n          animOpacity: new Animated.Value(0)\r\n      };\r\n      this._onLoad = this._onLoad.bind(this);\r\n      this._onError = this._onError.bind(this);\r\n      this._measureLayout = this._measureLayout.bind(this);\r\n  }\r\n\r\n  setNativeProps (nativeProps: { [key: string]: unknown }) {\r\n    this._container?.setNativeProps(nativeProps);\r\n  }\r\n\r\n  componentDidMount () {\r\n      this._mounted = true;\r\n\r\n      setTimeout(() => {\r\n          this._measureLayout();\r\n      }, 0);\r\n  }\r\n\r\n  componentWillUnmount () {\r\n      this._mounted = false;\r\n  }\r\n\r\n  _measureLayout () {\r\n      if (this._container) {\r\n          const {\r\n              dimensions,\r\n              carouselRef\r\n          } = this.props;\r\n\r\n          const nodeHandle = findNodeHandle(carouselRef);\r\n\r\n          if (carouselRef && nodeHandle) {\r\n              this._container.measureLayout(\r\n                  nodeHandle,\r\n                  (x, y, width, height) => {\r\n                      const offset = this.props.vertical ?\r\n                          y - (this.props.sliderHeight - this.props.itemHeight) / 2 :\r\n                          x - (this.props.sliderWidth - this.props.itemWidth) / 2;\r\n\r\n                      this.setState({\r\n                          offset: offset,\r\n                          width:\r\n                dimensions && dimensions.width ?\r\n                    dimensions.width :\r\n                    Math.ceil(width),\r\n                          height:\r\n                dimensions && dimensions.height ?\r\n                    dimensions.height :\r\n                    Math.ceil(height)\r\n                      });\r\n                  },\r\n                  // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n                  () => {}\r\n              );\r\n          }\r\n      }\r\n  }\r\n\r\n  _onLoad (event: NativeSyntheticEvent<ImageLoadEventData>) {\r\n      const { animOpacity } = this.state;\r\n      const { fadeDuration, onLoad } = this.props;\r\n\r\n      if (!this._mounted) {\r\n          return;\r\n      }\r\n\r\n      this.setState({ status: ParallaxImageStatus.LOADED });\r\n\r\n      if (onLoad) {\r\n          onLoad(event);\r\n      }\r\n\r\n      Animated.timing(animOpacity, {\r\n          toValue: 1,\r\n          duration: fadeDuration,\r\n          easing: Easing.out(Easing.quad),\r\n          isInteraction: false,\r\n          useNativeDriver: true\r\n      }).start(() => {\r\n          this.setState({ status: ParallaxImageStatus.TRANSITION_FINISHED });\r\n      });\r\n  }\r\n\r\n  // If arg is missing from method signature, it just won't be called\r\n  _onError (event: NativeSyntheticEvent<ImageErrorEventData>) {\r\n      const { onError } = this.props;\r\n\r\n      this.setState({ status: ParallaxImageStatus.ERROR });\r\n\r\n      if (onError) {\r\n          onError(event);\r\n      }\r\n  }\r\n\r\n  get image () {\r\n      const { status, animOpacity, offset, width, height } = this.state;\r\n      const {\r\n          scrollPosition,\r\n          // False positive :( other doesn't have the dimension key\r\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n          dimensions,\r\n          parallaxFactor,\r\n          style,\r\n          AnimatedImageComponent,\r\n          ...other\r\n      } = this.props;\r\n      const parallaxPadding = (this.props.vertical ? height : width) * parallaxFactor;\r\n      const requiredStyles = { position: 'relative' as const };\r\n      const dynamicStyles = {\r\n          width: this.props.vertical ? width : width + parallaxPadding * 2,\r\n          height: this.props.vertical ? height + parallaxPadding * 2 : height,\r\n          opacity: animOpacity,\r\n          transform: scrollPosition ?\r\n              [\r\n                  {\r\n                      translateX: !this.props.vertical ?\r\n                          scrollPosition.interpolate({\r\n                              inputRange: [offset - this.props.sliderWidth, offset + this.props.sliderWidth],\r\n                              outputRange: [-parallaxPadding, parallaxPadding],\r\n                              extrapolate: 'clamp'\r\n                          }) :\r\n                          0\r\n                  },\r\n                  {\r\n                      translateY: this.props.vertical ?\r\n                          scrollPosition.interpolate({\r\n                              inputRange: [offset - this.props.sliderHeight, offset + this.props.sliderHeight],\r\n                              outputRange: [-parallaxPadding, parallaxPadding],\r\n                              extrapolate: 'clamp'\r\n                          }) :\r\n                          0\r\n                  }\r\n              ] :\r\n              []\r\n      };\r\n\r\n      return (\r\n          <AnimatedImageComponent\r\n            {...other}\r\n            style={[styles.image, style, requiredStyles, dynamicStyles]}\r\n            onLoad={this._onLoad}\r\n            onError={status !== ParallaxImageStatus.TRANSITION_FINISHED ? this._onError : undefined} // prevent infinite-loop bug\r\n          />\r\n      );\r\n  }\r\n\r\n  get spinner () {\r\n      const { status } = this.state;\r\n      const { showSpinner, spinnerColor } = this.props;\r\n\r\n      return status === ParallaxImageStatus.LOADING && showSpinner ? (\r\n          <View style={styles.loaderContainer}>\r\n              <ActivityIndicator\r\n                size='small'\r\n                color={spinnerColor}\r\n                animating={true}\r\n              />\r\n          </View>\r\n      ) : (\r\n          false\r\n      );\r\n  }\r\n\r\n  render () {\r\n      const { containerStyle } = this.props;\r\n\r\n      return (\r\n          <View\r\n            ref={(c) => {\r\n                this._container = c;\r\n            }}\r\n            pointerEvents='none'\r\n            style={[containerStyle, styles.container]}\r\n            onLayout={this._measureLayout}\r\n          >\r\n              {this.image}\r\n              {this.spinner}\r\n          </View>\r\n      );\r\n  }\r\n}\r\n"]}